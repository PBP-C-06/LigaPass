<!-- Untuk melengkapi profile setelah registrasi -->

{% block content %}

    <h1>Welcome to LigaPass, {{user.username}}!</h1>
    <p>Customize your profile before purchasing tickets ðŸŽ«</p>

    <form id="profileForm" method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <!-- Profile Picture -->
        <div>
            <label for="profile_picture">Profile Picture</label><br>
            <input type="file" id="profile_picture" name="profile_picture" accept="image/*">
        </div>

        <!-- Full name -->
        <div>
            <label for="name">Full Name</label><br>
            <input type="text" id="name" name="name" value="{{ user.get_full_name|title }}" readonly>
        </div>

        <!-- Username -->
        <div>
            <label for="name">Username</label><br>
            <input type="text" id="username" name="username" value="{{ user.username }}" readonly>
        </div>

        <!-- Email -->
        <div>
            <label for="email">Email</label><br>
            <input type="email" id="email" name="email" value="{{ user.email }}" readonly>
        </div>

        <!-- Phone Number -->
        <div>
            <label for="phone">Phone Number</label><br>
            <input type="tel" id="phone" name="phone" placeholder="Enter phone number" required>
        </div>

        <!-- Date of Birth -->
        <div>
            <label for="date_of_birth">Date of Birth</label><br>
            <input type="date" id="date_of_birth" name="date_of_birth" required>
        </div>

        <!-- Submit -->
        <button type="submit">Next</button>
    </form>

    <script>
        document.getElementById('profileForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const form = e.target;
        const formData = new FormData(form);
        
        try {
            const response = await fetch("{% url 'profiles:create_profile' %}", {
                method: "POST",
                headers: {
                    'X-CSRFToken': formData.get('csrfmiddlewaretoken'),
                },
                body: formData,
            });
        
            if (response.ok) {
                alert("Profile saved!");
                setTimeout(() => {
                    window.location.href = "{% url 'main:show_main' %}";
                }, 1500);
            } else {
                const errorText = await response.text();
                alert("Failed to save profile: " + errorText);
            }
        } catch (error) {
            alert("Something went wrong while sending the data. Please try again.");
        }
        });
    </script>
{% endblock %}