<!-- Wrapper utama komentar. 
 Setiap blok komentar diberi ID agar bisa dihapus/dimodifikasi lewat JavaScript. 
-->>
<div class="{% if not is_child %}mb-6{% else %}ml-6 mt-4 border-l-2 border-gray-300 pl-4{% endif %} comment-block" id="comment-{{ comment.id }}">
  
  <!-- Baris utama yang mengatur layout horizontal komentar (avatar + isi komentar) -->
  <div class="flex items-start space-x-4">

    <!-- Kontainer isi komentar: username, waktu, isi, aksi -->
    <div class="bg-gray-100 rounded-md p-3 w-full">

      <!-- Tampilkan username yang memberi komentar -->
      <div class="text-sm text-gray-800 font-semibold">{{ comment.user.username }}</div>

      <!-- Tampilkan tanggal komentar dibuat, dengan format 24 jam -->
      <div class="text-sm text-gray-600">{{ comment.created_at|date:"d M Y H:i" }}</div>

      <!-- Isi komentar -->
      <p class="mt-2 text-gray-700">{{ comment.content }}</p>

      <!-- Tampilkan tombol like/unlike hanya jika user sudah login -->
      {% if request.user.is_authenticated %}
        <form method="post" action="{% url 'news:like_comment' comment.id %}" data-like-form class="inline-block mt-2">
          {% csrf_token %}

          <!-- Cek apakah user sudah like komentar ini atau belum, untuk menentukan tombol -->
          {% if comment.user_has_liked %}
            <button type="submit" class="text-red-600 hover:underline text-sm">❤️ Unlike</button>
          {% else %}
            <button type="submit" class="text-gray-600 hover:underline text-sm">🤍 Like</button>
          {% endif %}
          <!-- Jumlah total like ditampilkan di samping tombol -->
          <span class="text-sm text-gray-500 ml-1">({{ comment.likes.count }})</span>
        </form>
      {% endif %}

      <!-- Tombol hapus hanya muncul jika user saat ini adalah pemilik komentar -->
      {% if request.user == comment.user %}
        <button
          type="button"
          class="text-sm text-red-600 hover:underline"
          onclick="openDeleteCommentModal('{{ comment.id }}')">
          Hapus
        </button>
      {% endif %}

      <!
 Tampilkan tombol balas dan form balasan jika user login       {% if request.user.is_authenticated %}
        <button onclick="toggleReplyForm('{{ comment.id }}')" class="text-sm text-blue-600 hover:unde---->rline mt-2">Balas</button>
        <!-- Form balasan komentar (hidden secara default), akan muncul saat tombol "Balas" diklik -->
        <form method="post" class="hidden mt-2 reply-form" id="reply-form-{{ comment.id }}" data-comment-id="{{ comment.id }}">
          {% csrf_token %}
          <!-- Textarea untuk isi balasan -->
          <textarea name="content" rows="2" class="w-full px-3 py-2 border rounded-md text-sm mb-2" placeholder="Balas komentar..."></textarea>
          <!-- Hidden input berisi ID komentar induk (parent_id) -->
          <input type="hidden" name="parent_id" value="{{ comment.id }}">
          <!-- Tombol kirim balasan -->
          <button type="submit" class="px-3 py-1 bg-blue-500 text-white rounded text-sm">Kirim</button>
        </form>
      {% endif %}
    </div>
  </div>

  <!-- Tempat untuk balasan komentar -->
  <div class="replies mt-3" id="replies-{{ comment.id }}">
    {% for reply in comment.replies.all %}
      <!-- Panggil template ini untuk render balasan -->
      {% include "news/comment_tree.html" with comment=reply is_child=True %}
    {% endfor %}
  </div>
</div>

