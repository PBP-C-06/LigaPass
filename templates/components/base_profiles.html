{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mx-auto px-4 sm:px-6 lg:px-8 py-10">
    <div class="flex flex-col lg:flex-row gap-8">
        
        <!-- Sidebar -->
        <div class="lg:w-1/4 w-full flex-shrink-0 bg-white p-6 rounded-xl shadow-lg border border-gray-100 h-[570px] overflow-y-auto">
            
            <!-- Profile infos -->
            <div class="flex flex-col items-center text-center pb-6 border-b border-gray-200 mb-6">
                <img id="base-profile-picture" src="{% static 'images/default-profile-picture.png' %}" 
                    alt="Foto Profil" 
                    class="h-20 w-20 rounded-full object-cover border-4 border-gray-100 shadow-md">
                <h2 id="base-username" class="mt-3 text-xl font-semibold text-gray-800"></h2>
                <p id="base-email" class="text-sm text-gray-500"></p>
            </div>
            
            <!-- Navigation links -->
            <nav id="sidebar-menu" class="space-y-1">
            </nav>

        </div>

        <!-- Main content -->
        <div class="lg:w-3/4 w-full">
            {% block profile_content %}
            {% endblock profile_content %}
        </div>
        
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function() {
    fetch("{% url 'profiles:current_user_json' %}")
        .then(response => response.json())
        .then(data => {
            // Profile infos
            document.getElementById("base-profile-picture").src = data.profile_picture;
            document.getElementById("base-username").textContent = data.username;
            document.getElementById("base-email").textContent = data.email;

            // Render menu
            const menuContainer = document.getElementById("sidebar-menu");
            menuContainer.innerHTML = ""; 

            const currentPath = window.location.pathname;

            data.menu.forEach(item => {
                const link = document.createElement("a");
                link.href = item.url;
                link.className = "block p-3 text-base font-medium rounded-lg transition-colors";

                // Highlight menu yang sedang aktif
                if (currentPath === new URL(item.url, window.location.origin).pathname) {
                    link.classList.add("bg-red-50", "text-red-600");
                } else {
                    link.classList.add("text-gray-600","hover:bg-gray-50","hover:text-gray-800");
                }

                // Tambahkan text menu saja, tanpa icon
                link.textContent = item.name;

                menuContainer.appendChild(link);
            });
        })
        .catch(err => console.error("Error fetching user data:", err));
});
</script>
{% endblock content %}

